'use strict';

angular.module('SgmapRetraiteExploit').controller('GetUserDataCtrl', function ($scope, $state, InfoRetraite, PromptService) {
    
    $scope.listeDepartements = [];
    $scope.listeDepartements.push('');
    for(var i = 1; i < 9; i++) {
        $scope.listeDepartements.push("0"+i);
    }
    for(var j = 10; j < 19; j++) {
        $scope.listeDepartements.push(""+j);
    }
    $scope.listeDepartements.push("2A");
    $scope.listeDepartements.push("2B");
    for(var k = 21; k < 98; k++) {
        $scope.listeDepartements.push(""+k);
    }

    $scope.data = {};

    $scope.testData = function() {
        InfoRetraite
            .get($scope.data.nom, $scope.data.nir, $scope.data.dateNaissance)
            .then(function onSuccess(data) {
                if (data.status == 'FOUND') {
                    $scope.regimes = data.regimes;
                } else if (data.status == 'NOTFOUND') {
                    PromptService.promptInformation("Aucune réponse du serveur avec ces informations ...");
                    delete $scope.regimes;
                } else {
                    
                    PromptService.promptInformation("Une erreur s'est produite (problème de format de vos données ou erreur interne) ...");
                    delete $scope.regimes;
                }
            }, 
            function onError(error) {
                PromptService.promptInformation("Il y a eu une erreur : ", error.statusText);
            });
    };

    $scope.nextStep = function() {
        $state.go('step2');
    };
    
});

