'use strict';

describe('InfoRetraite', function () {

    beforeEach(module('SgmapRetraiteExploit'));

    var InfoRetraite, $httpBackend;

    beforeEach(inject(function (_InfoRetraite_, _$httpBackend_) {
        InfoRetraite = _InfoRetraite_;
        $httpBackend = _$httpBackend_;
    }));

    it('should call WS and resolve promise if success', function (done) {

        $httpBackend
            .expectGET('/api/inforetraite?dateNaissance=12%2F08%2F1888&name=Dupont&nir=123456')
            .respond(200, {data: 'mes data'});

        var promise = InfoRetraite.get("Dupont", "123456", "12/08/1888");

        promise.then(function onSuccess(result) {
            expect(result.data).toEqual('mes data');
            done();
        }, function onError(err) {
            jasmine.fail("Ne devrait pas passer ici");
        });

        $httpBackend.flush();
    });

    it('should call WS and reject promise if error', function (done) {

        $httpBackend
            .expectGET('/api/inforetraite?dateNaissance=12%2F08%2F1888&name=Dupont&nir=123456')
            .respond(404, 'Data not found');

        var promise = InfoRetraite.get("Dupont", "123456", "12/08/1888");

        promise.then(function onSuccess(result) {
            jasmine.fail("Ne devrait pas passer ici");
        }, function onError(error) {
            expect(error.status).toEqual(404);
            expect(error.data).toEqual('Data not found');
            done();
        });

        $httpBackend.flush();
    });

});
