'use strict';

angular.module('SgmapRetraiteExploit').controller('MainCtrl', function ($scope, $state) {
    
    $scope.listeAnneesNaissance = [];
    $scope.listeAnneesNaissance.push('');
    for(var i = 1945; i < 2015; i++) {
        $scope.listeAnneesNaissance.push(i);
    }
    
    $scope.listeAnneesDepart = [];
    $scope.listeAnneesDepart.push('');
    for(var j = 0; j < 10; j++) {
        $scope.listeAnneesDepart.push(2015+j);
    }
    
    $scope.listeMois = ['', 'Janvier','Février','Mars','Avril','Mai','Juin','Juillet','Août','Septembre','Octobre','Novembre','Décembre'];
    
    $scope.listeMoisAvecPremier = [];
    $scope.listeMois.forEach(function(mois) {
        if (mois.length === 0) {
            $scope.listeMoisAvecPremier.push(mois);
        } else {
            $scope.listeMoisAvecPremier.push("1er "+mois);
        }
    });
    
    var changeStep = function(increment) {
        var currentStep = $state.current;
        var numStep = parseInt(currentStep.name.substr('step'.length));
        var nextNumStep = numStep+increment;
        $state.go('step'+nextNumStep);
    };
    
    $scope.nextStep = function() {
        var currentStep = $state.current;
        if (currentStep.next) {
            $state.go(currentStep.next);
        } else {
            changeStep(+1);
        }
        return false;
    };
    
    $scope.prevStep = function() {
        var currentStep = $state.current;
        if (currentStep.prev) {
            $state.go(currentStep.prev);
        } else {
            changeStep(-1);
        }
        return false;
    };
    
    $scope.isTrue = function(val) {
        return val === true || val === 'true';
    };

    $scope.caisses = [
        {
            description: "Exploitant agricole"
        },{
            description: "Salarié agricole"
        },{
            description: "Autre"
        }
    ];
    
    $scope.checkList = [
        {
            titre: "Je reconstitue ma carrière",
            delai: "Dès aujourd'hui",
            infos: "Avez-vous déjà vérifié que les données de votre relevé de situation "
                +"individuelle sont exactes et complètes ? Si oui, passez à l’étape suivante. Sinon, suivez les étapes ci-dessous",
            actions: [
                "Je crée mon espace privé sur le site Internet de ma caisse MSA pour avoir "
                    +"accès aux services en ligne personnalisés <a href='http://www.msa.fr/lfr/espace-prive' target='_blank'>ICI</a>.",
                "Dans mon espace privé « Mon compte », je choisis « Internet » comme "
                    +"préférence de mode de réception des documents et des informations de mon dossier personnel.",
                "Dans mon espace privé, je consulte mon relevé de situation individuelle.",
                "Je <a href='#' title='En savoir plus...'>vérifie</a> que les données de "
                    +"mon relevé de situation individuelle sont exactes et complètes.",
                "Si j’identifie des périodes manquantes ou informations erronées, je demande "
                    +"une régularisation de ma carrière en envoyant par courrier ou en déposant à mon agence les pièces justificatives correspondantes."
            ],
            precisions: [
                "Je peux à tout moment adresser mes questions par mail à mon conseiller depuis mon espace privé."
            ]
        },{
            titre: "Je contacte ma retraite complémentaire",
            delai: "Le plus tôt possible",
            infos: "Nous avons détecté que vous dépendez pour votre retraite complémentaire de "
                    +"l'AGIRC-ARRCO. Vous devez effectuer une demande distincte auprès de cet organisme.",
            actions: [
                "Je fais ma demande en téléphonant au 0 820 200 189 pour contacter un conseiller "
                    +"retraite (Service 0,09 € TTC la min. + prix appel).",
                "Ou directement, en cliquant sur <a href='http://www.retraite-repartition.fr/rnet/' "
                    +"target='_blank'>Demander sa retraite en ligne</a>."
            ]
        },{
            titre: "Je contacte mes autres retraites",
            delai: "Le plus tôt possible",
            infos: "Nous avons détecté que vous dépendez également de... Vous devez effectuer une "
                +"demande distincte auprès de cet organisme.",
            actions: [
                "Je prends contact avec mon/mes autres retraites de retraite ICI afficher les "
                    +"coordonnées des caisses concernés telles qu’extraites de l’annuaire retraite."
            ]
        },{
            titre: "Je notifie ma date de départ à mon employeur ou à Pôle emploi",
            delai: "Avril à juin 2017"
        },{
            titre: "Je récupère mon dossier",
            delai: "Avant avril 2017",
            actions: [
                "Je prends connaissance de mon dossier de demande unique de retraite personnelle en "
                    +"ligne, accessible dans mon espace privé. Ajouter le lien + nom de la rubrique"
            ]
        },{
            titre: "Je constitue mon dossier",
            delai: "Avant juin 2017",
            actions: [
                "Je prends connaissance des pièces justificatives à envoyer.",
                "Je remplis mon dossier de demande unique de retraite personnelle en ligne, accessible "
                    +"dans mon espace privé."
            ],
            precisions: [
                "Si je rencontre des difficultés, je peux contacter XXX (agence ? plate-forme ?) pour "
                    +"obtenir de l’aide /// ou // Si je rencontre des difficultés, je peux opter pour le dossier papier (téléchargement/retrait en agence ou téléphone)"
            ]
        },{
            titre: "Je dépose mon dossier",
            delai: "Avant juin 2017",
            infos: "",
            actions: [
                "Ma MSA me contacte (peut-on ici indiquer un délai maximum ou indicatif ?) pour me demander "
                    +"les pièces justificatives à envoyer et je les dépose en agence ou je les envoie par courrier.",
                "Je reçois par courrier, dans un délai d’1 mois maximum, un accusé de réception. Je conserve ces documents."
            ]
        },{
            titre: "Je suis l’avancée de mon dossier",
            delai: "?",
            actions: [
                "Ma MSA ou une autre caisse peut me contacter pour me demander des pièces complémentaires. "
                    +"Le courrier précisera les modalités de transmission de ces pièces."
            ],
            precisions: [
                "L’instruction moyenne du dossier dure environ 2 mois. Passé ce délai, je peux prendre contact "
                    +"avec la MSA pour connaitre l’avancée de mon dossier."
            ]
        },{
            titre: "J’obtiens ma retraite",
            delai: "Octobre 2017",
            infos: "",
            actions: [
                "Je reçois par courrier ma notification de paiement.",
                "Je reçois mon premier versement.",
                "Je peux suivre mes versements dans mon espace personnel."
            ],
            precisions: [
                "Attention : ce montant n’inclut pas votre retraite complémentaire ni les droits que vous avez acquis auprès de xxx.",
                "Veuillez noter que la date de versement indiquée dans votre notification de paiement "
                    +"correspond à la date de l’opération bancaire. Les délais de traitement de votre banque peuvent occasionner un décalage d’une à deux journées ouvrées.",
                "En tant que retraité, je peux bénéficier de nouveaux services. Veuillez consulter la page Internet « XXXXX ». Ajouter le lien"
            ]
        }
    ];
    
    /*var wrapLinks = function() {
        var wrapLink = function(url) {
            return "<a href='"+url+"' target='_blank'>ICI</a>";
        };
        
        var wrapLinksInAction = function(action) {
            var beginIndex = action.indexOf('http');
            while (beginIndex > 0) {
                var endIndex = action.indexOf(' ', beginIndex);
                var url = action.substr(beginIndex, endIndex-beginIndex);
                action = action.substr(0, beginIndex) + wrapLink(url) + action.substr(endIndex);
                beginIndex = action.indexOf('http');
            }
        };
        
        var wrapLinksInCheckPoint = function(checkPoint) {
            if (checkPoint.actions && checkPoint.actions.length > 0) {
                var newActions = [];
                angular.forEach(checkPoint.actions, function(action) {
                    wrapLinksInAction(action);
                });    
                checkPoint.actions = newActions;
            }
        };
        
        $scope.checkList.forEach(function(checkPoint) {
            wrapLinksInCheckPoint(checkPoint);
        });
    };
    wrapLinks();*/
    
});

